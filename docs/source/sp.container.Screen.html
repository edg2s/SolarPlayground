<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='sp-container-Screen'>/**
</span> * Solar Playground screen controller for canvas and context elements
 *
 * @class sp.container.Screen
 * @mixins OO.EventEmitter
 *
 * @param {Object} [config] Configuration object
 */
sp.container.Screen = function SpContainerScreen( config ) {
	this.config = config || {};

	// Mixin constructors
	OO.EventEmitter.call( this );

	this.canvasCenterPoint = { x: 0, y: 0 };

	// Initialize
	this.$canvas = $( &#39;&lt;canvas&gt;&#39; )
		.addClass( &#39;sp-container-canvas&#39; )
		.attr( &#39;width&#39;, this.config.width )
		.attr( &#39;height&#39;, this.config.height );

	this.context = this.$canvas[0].getContext( &#39;2d&#39; );

	// Events
	this.$canvas.on( &#39;mousedown&#39;, $.proxy( this.onCanvasMouseDown, this ) );
	this.$canvas.on( &#39;mousemove&#39;, $.proxy( this.onCanvasMouseMove, this ) );
	this.$canvas.on( &#39;mouseup&#39;, $.proxy( this.onCanvasMouseUp, this ) );
	this.$canvas.on( &#39;mouseout&#39;, $.proxy( this.onCanvasMouseUp, this ) );
};

/* Inheritance */

OO.mixinClass( sp.container.Screen, OO.EventEmitter );

/* Events */

<span id='sp-container-Screen-event-drag'>/**
</span> * @event drag
 * @param {string} action Drag action &#39;start&#39;, &#39;during&#39; or &#39;end&#39;
 * @param {Object|null} coords Mouse x/y coordinates.
 *  * For &#39;start&#39; action, coords are mouseStartingPoint
 *  * For &#39;during&#39; action, coords are the relative distance between
 *    the current mouse coordinates and the initial dragging point.
 *    (In other words, it is the distance &#39;dragged&#39; by the mouse)
 *  * For &#39;end&#39; action, coords are not supplied.
 * point, depending on the action.
 * Dragging the mouse on the screen (moving while mousedown)
 */

<span id='sp-container-Screen-method-onCanvasMouseDown'>/**
</span> * Propogate canvas mousedown event
 * @param {Event} e Event
 * @fires startDrag
 */
sp.container.Screen.prototype.onCanvasMouseDown = function ( e ) {
	this.canvasMouseMoving = true;
	this.mouseStartingPoint = {
		&#39;x&#39;: e.pageX,
		&#39;y&#39;: e.pageY
	};
	this.emit( &#39;drag&#39;, &#39;start&#39;, this.mouseStartingPoint );
};

<span id='sp-container-Screen-method-onCanvasMouseMove'>/**
</span> * Respond to canvas mouse move
 * @param {Event} e Event
 * @fires drag
 */
sp.container.Screen.prototype.onCanvasMouseMove = function ( e ) {
	var coords;
	if ( this.canvasMouseMoving &amp;&amp; !$.isEmptyObject( this.mouseStartingPoint ) ) {
		dx = e.pageX - this.mouseStartingPoint.x;
		dy = e.pageY - this.mouseStartingPoint.y;

		coords = {
			&#39;x&#39;: dx + this.canvasCenterPoint.x,
			&#39;y&#39;: dy + this.canvasCenterPoint.y
		};
		this.emit( &#39;drag&#39;, &#39;during&#39;, coords );
	}
};

<span id='sp-container-Screen-method-onCanvasMouseUp'>/**
</span> * Propogate canvas mouseup event
 * @param {Event} e Event
 * @fires drag
 */
sp.container.Screen.prototype.onCanvasMouseUp = function ( e ) {
	this.canvasMouseMoving = false;
	this.mouseStartingPoint = {};
	this.canvasCenterPoint = {};
	this.emit( &#39;drag&#39;, &#39;end&#39; );
};

<span id='sp-container-Screen-method-drawCircle'>/**
</span> * Draw a circle on the canvas
 * @param {Object} coords Canvas coordinates
 * @param {number} [radius] Circle radius
 * @param {string} [color] Circle color
 * @param {boolean} [hasShadow] Add a shadow
 */
sp.container.Screen.prototype.drawCircle = function ( coords, radius, color, hasShadow ) {
	this.context.save();
	this.context.beginPath();
	this.context.arc(
		coords.x,
		coords.y,
		radius || 5, 0, 2 * Math.PI,
		false
	);
	this.context.fillStyle = color || &#39;white&#39;;
	if ( hasShadow ) {
		this.context.shadowColor = color || &#39;white&#39;;
		this.context.shadowBlur = 20;
		this.context.shadowOffsetX = 0;
		this.context.shadowOffsetY = 0;
	}
	this.context.fill();
	this.context.restore();
};

<span id='sp-container-Screen-method-clear'>/**
</span> * Clear an area on the canvas
 * @param {number} [square] Dimensions and coordinates of the square
 * to clear. If not set, the entire canvas will be cleared.
 * @param {number} [square.top] Top coordinate of the square
 * @param {number} [square.left] Left coordinate of the square
 * @param {number} [square.width] Width of the square
 * @param {number} [square.height] Height of the square
 */
sp.container.Screen.prototype.clear = function ( square ) {
	var canvasDimensions = this.getDimensions();
	square = square || {};

	// Fix optional values:
	square.left = square.left || 0;
	square.top = square.top || 0;
	square.width = square.width || canvasDimensions.width;
	square.height = square.height || canvasDimensions.height;

	// Erase the square
	this.context.clearRect( square.left, square.top, square.width, square.height );
};

<span id='sp-container-Screen-method-setCenterPoint'>/**
</span> * Set the center point of the center of the scenario.
 * @param {Object} coords Center of scenario coordinates
 */
sp.container.Screen.prototype.setCenterPoint = function ( coords ) {
	this.canvasCenterPoint = {
		&#39;x&#39;: coords.x,
		&#39;y&#39;: coords.y
	};
};

<span id='sp-container-Screen-method-getCenterPoint'>/**
</span> * Get the canvas center point
 * @returns {Object} Center point
 */
sp.container.Screen.prototype.getCenterPoint = function () {
	return this.canvasCenterPoint;
};

<span id='sp-container-Screen-method-getContext'>/**
</span> * Get the canvas context
 * @returns {Object} Canvas context
 */
sp.container.Screen.prototype.getContext = function () {
	return this.$canvas[0].getContext( &#39;2d&#39; );
};

<span id='sp-container-Screen-method-getDimensions'>/**
</span> * Get the canvas dimensions
 * @returns {Object} Width and height of the canvas
 */
sp.container.Screen.prototype.getDimensions = function () {
	return {
		&#39;width&#39;: this.$canvas.width(),
		&#39;height&#39;: this.$canvas.height()
	}
};
</pre>
</body>
</html>
